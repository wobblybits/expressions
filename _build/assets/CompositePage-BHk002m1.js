import{b as w,F as x,G as T,t as c,w as g,H as n,A as m,j as p,I as S,J as v,m as z}from"./web-4ew4HSQc.js";import{E as A,a as D,S as H,N as f,F as J}from"./Face-Cuc20oiI.js";import{C as R}from"./ClientOnly-moobLJRC.js";var W=g('<div style="max-width:100%;max-height:100%;aspect-ratio:1 / 1;object-fit:contain;margin-top:2em"><div id=composite-grid style="grid-template-columns:auto repeat(8, 1fr);grid-template-rows:auto repeat(8, 1fr);align-items:center;justify-items:center;object-fit:contain"><div class=grid-label></div><!$><!/><!$><!/>'),q=g("<div style=align-items:center;justify-content:center;padding:2em;box-sizing:border-box>"),B=g("<div id=loading>"),j=g("<div class=grid-label><h4>"),K=g('<div style="background:white;border:1px solid black;min-width:4em;min-height:4em;align-items:center;justify-content:center;object-fit:contain;aspect-ratio:1 / 1">'),Q=g("<div>");const Y=()=>{const k=new A,E=new D(k),_={angry:80,contempt:120,disgust:80,fear:150,happy:80,neutral:80,sad:50,surprise:80},C=new H(140,140),[y,$]=w(new Set),[F,M]=w(new Set);x(()=>{$(new Set(["face0-0"]))}),T(()=>{console.log("effect");const t=F(),r=y();for(let e=0;e<Object.keys(f).length;e++)for(let s=0;s<Object.keys(f).length;s++){const i=`face${e}-${s}`;if(!t.has(i)&&!r.has(i)){$(a=>new Set([...a,i]));break}}});const N=t=>{M(r=>new Set([...r,t])),$(r=>{const e=new Set(r);return e.delete(t),e})};return x(()=>{const t=new MutationObserver(r=>{r.forEach(e=>{e.type==="childList"&&e.addedNodes.forEach(s=>{if(s.nodeType===Node.ELEMENT_NODE){const i=s;if(i.tagName==="IMG"&&i.src&&i.src.startsWith("data:")){const a=i.closest(".face");a&&a.id&&N(a.id)}}})})});return t.observe(document.body,{childList:!0,subtree:!0}),()=>t.disconnect()}),(()=>{var t=c(q);return n(t,"width","90vw"),n(t,"height","95vh"),n(t,"display","flex"),m(t,p(R,{get fallback(){return c(B)},get children(){var r=c(W),e=r.firstChild,s=e.firstChild,i=s.nextSibling,[a,O]=S(i.nextSibling),L=a.nextSibling,[I,G]=S(L.nextSibling);return n(e,"display","grid"),n(e,"gap","2px"),m(e,p(v,{get each(){return Object.keys(f)},children:(h,b)=>(()=>{var o=c(j),l=o.firstChild;return m(l,h),o})()}),a,O),m(e,p(v,{get each(){return Object.keys(f)},children:(h,b)=>[(()=>{var o=c(j),l=o.firstChild;return m(l,h),o})(),p(v,{get each(){return Object.keys(f)},children:(o,l)=>(()=>{var d=c(K);return n(d,"width","auto"),n(d,"height","auto"),n(d,"display","flex"),n(d,"overflow","hidden"),m(d,(()=>{var P=z(()=>!!y().has(`face${b()}-${l()}`));return()=>P()?p(J,{get id(){return`face${b()}-${l()}`},width:140,height:140,expressionModel:E,get emotionLevels(){return{[h]:_[h],[o]:_[o]}},scene:C}):(()=>{var u=c(Q);return n(u,"width","100%"),n(u,"height","100%"),n(u,"background","#333"),u})()})()),d})()})]}),I,G),r}})),t})()};export{Y as default};
